<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Discord Webhook Manager ‚Äî Touch First</title>
<style>
:root{
  --accent:#5865f2; --accent-press:#4752c4;
  --bg:#f5f7fb; --bg-dark:#0f1114;
  --card:#fff; --card-dark:#16181f;
  --text:#0e1015; --text-dark:#e6e6e6; --muted:#6b7280; --muted-dark:#9aa2b1;
  --radius:14px; --shadow:0 8px 26px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial; background:var(--bg); color:var(--text);} 
body.dark{ background:var(--bg-dark); color:var(--text-dark);} 

.container{ max-width:980px; margin:12px auto 100px; padding:0 12px; }
.card{ background:var(--card); border-radius:var(--radius); padding:16px; margin:12px 0; box-shadow:var(--shadow); border:1px solid rgba(0,0,0,.06); }
body.dark .card{ background:var(--card-dark); box-shadow:none; border-color:rgba(255,255,255,.06);} 

/* Tabs */
.tabs{ display:flex; gap:8px; flex-wrap:wrap; }
.tab{ padding:10px 14px; border-radius:999px; cursor:pointer; border:1px solid rgba(0,0,0,.1); }
.tab.active{ background:var(--accent); color:#fff; border-color:transparent; font-weight:800; }
.tab-panel{ display:none; }
.tab-panel.active{ display:block; }

/* Inputs */
label{ display:block; margin:10px 0 6px; font-weight:800; }
input[type="text"], input[type="url"], input[type="color"], textarea, select{ width:100%; padding:12px; border-radius:12px; border:1.5px solid #d7d7d9; background:transparent; color:inherit; font-size:16px; transition:border-color .15s, box-shadow .15s; }
input:focus, textarea:focus, select:focus{ outline:none; border-color:var(--accent); box-shadow:0 6px 20px rgba(88,101,242,.18); }
textarea{ min-height:110px; resize:vertical; }
.helper{ color:var(--muted); font-size:12px; }
body.dark .helper{ color:var(--muted-dark);} 

/* Preview */
.preview{ border:1px dashed rgba(0,0,0,.12); border-radius:12px; padding:12px; background:rgba(0,0,0,.02); max-height:220px; overflow:auto; }
body.dark .preview{ border-color:rgba(255,255,255,.12); background:rgba(255,255,255,.04); }
.msg{ display:flex; gap:10px; align-items:flex-start; }
.msg .avatar{ width:42px; height:42px; border-radius:8px; object-fit:cover; }
.msg .name{ font-weight:900; }
.embed{ border-left:4px solid var(--accent); padding:8px 10px; margin-top:10px; border-radius:6px; background:rgba(0,0,0,.03); }
body.dark .embed{ background:rgba(255,255,255,.05); }

/* Toast / response / banner */
.toast{ position:fixed; right:18px; bottom:90px; background:#111; color:#fff; padding:9px 12px; border-radius:10px; display:none; box-shadow:0 10px 30px rgba(0,0,0,.25); }
.response{ margin-top:10px; padding:12px; border-radius:10px; font-weight:800; }
.response.ok{ background:#dcfce7; color:#166534; }
.response.err{ background:#fee2e2; color:#7f1d1d; }
.banner{ background:#ffecb3; color:#333; padding:8px 10px; border-radius:10px; margin:10px 0; font-size:14px; display:none; }

/* Floating Send (thumb reach) */
.fab{
  position:fixed; right:16px; bottom:16px; z-index:60;
  background:linear-gradient(135deg,var(--accent),var(--accent-press)); color:#fff;
  border:none; border-radius:999px; padding:14px 18px; font-weight:900; box-shadow:0 16px 40px rgba(88,101,242,.3); cursor:pointer;
  display:flex; align-items:center; gap:10px; font-size:16px;
}
.fab:active{ transform:translateY(1px); }

.btn-alt{ background:transparent; color:var(--accent); border:1.5px solid var(--accent); padding:8px 10px; border-radius:10px; cursor:pointer; }

.embed-card{ border:1px solid rgba(0,0,0,.08); border-radius:12px; padding:12px; margin:12px 0; }
body.dark .embed-card{ border-color:rgba(255,255,255,.08);} 

@media (hover:hover){ .fab:hover{ filter:brightness(1.03);} }
@media (max-width:720px){ .tab{ flex:1; text-align:center; } }
</style>
</head>
<body>

<!-- Floating action send button (bottom-right) -->
<button id="fabSend" class="fab">üöÄ Send</button>

<div class="container">
  <h1 style="text-align:center; margin:8px 0 10px; color:var(--accent); font-size:28px; font-weight:900;">Discord Webhook Manager</h1>
  <div id="banner" class="banner">‚ö†Ô∏è Running from a local file or preview app may block network requests (CORS). For live sending, open this file in a regular browser.</div>

  <div class="card">
    <div class="tabs" role="tablist">
      <div class="tab active" data-tab="webhook" role="tab">Webhook</div>
      <div class="tab" data-tab="message" role="tab">Message</div>
      <div class="tab" data-tab="embeds" role="tab">Embeds</div>
      <div class="tab" data-tab="settings" role="tab">Settings</div>
    </div>

    <section id="tab-webhook" class="tab-panel active" role="tabpanel">
      <label for="webhookURL">Webhook URL</label>
      <input id="webhookURL" type="url" placeholder="https://discord.com/api/webhooks/..." autocomplete="url"/>
      <div class="helper">Paste the full Discord webhook URL for the channel you want to post to.</div>
    </section>

    <section id="tab-message" class="tab-panel" role="tabpanel">
      <label for="username">Username</label>
      <input id="username" type="text" placeholder="Displayed username (optional)"/>
      <label for="avatarURL">Avatar URL</label>
      <input id="avatarURL" type="url" placeholder="https://‚Ä¶ (optional)"/>
      <label for="content">Message</label>
      <textarea id="content" placeholder="Type your message‚Ä¶"></textarea>
    </section>

    <section id="tab-embeds" class="tab-panel" role="tabpanel">
      <button class="btn-alt" id="addEmbed">‚ûï Add Embed</button>
      <div id="embeds"></div>
    </section>

    <section id="tab-settings" class="tab-panel" role="tabpanel">
      <label style="display:flex;gap:8px;align-items:center;">
        <input type="checkbox" id="darkToggle"/> Enable Dark Mode
      </label>
    </section>
  </div>

  <div class="card">
    <strong>Preview</strong>
    <div id="preview" class="preview" aria-live="polite">
      <div class="helper">Start typing to see a live preview‚Ä¶</div>
    </div>
    <div id="resp" class="response" style="display:none"></div>
  </div>
</div>

<div id="toast" class="toast">Copied</div>

<script>
/************ Elements ************/
const tabs=[...document.querySelectorAll('.tab')];
const panels={ webhook:document.getElementById('tab-webhook'), message:document.getElementById('tab-message'), embeds:document.getElementById('tab-embeds'), settings:document.getElementById('tab-settings') };
const webhookURL=document.getElementById('webhookURL');
const username=document.getElementById('username');
const avatarURL=document.getElementById('avatarURL');
const content=document.getElementById('content');
const addEmbedBtn=document.getElementById('addEmbed');
const embedsEl=document.getElementById('embeds');
const preview=document.getElementById('preview');
const resp=document.getElementById('resp');
const toast=document.getElementById('toast');
const banner=document.getElementById('banner');
const darkToggle=document.getElementById('darkToggle');
const fabSend=document.getElementById('fabSend');

let embeds=[]; // {title, description, color}

/************ Tabs ************/
tabs.forEach(t=>t.addEventListener('click',()=>{ tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active'); Object.values(panels).forEach(p=>p.classList.remove('active')); panels[t.dataset.tab].classList.add('active'); }));

/************ Theme ************/
function applyTheme(dark){ document.body.classList.toggle('dark', dark); localStorage.setItem('webhook_dark', dark?'1':'0'); }
darkToggle.addEventListener('change', e=> applyTheme(e.target.checked));
(function(){ const saved=localStorage.getItem('webhook_dark'); const dark = saved? saved==='1' : window.matchMedia && matchMedia('(prefers-color-scheme: dark)').matches; darkToggle.checked=dark; applyTheme(dark); })();

/************ Preview ************/
const esc=s=>String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
function renderPreview(){
  const name=esc(username.value||'Webhook');
  const avatar=esc(avatarURL.value||'https://cdn.discordapp.com/embed/avatars/0.png');
  const msg=esc(content.value||'');
  let html=`<div class="msg"><img class="avatar" src="${avatar}" alt="avatar"/><div><div class="name">${name}</div><div style="margin-top:6px;white-space:pre-wrap">${msg}</div></div></div>`;
  embeds.forEach(e=>{
    const color=e.color||'#5865f2';
    html+=`<div class="embed" style="border-color:${esc(color)}">${e.title?`<div style="font-weight:800">${esc(e.title)}</div>`:''}${e.description?`<div style="margin-top:6px;white-space:pre-wrap">${esc(e.description)}</div>`:''}</div>`;
  });
  preview.innerHTML=html;
}
[username,avatarURL,content].forEach(el=> el.addEventListener('input', renderPreview));

/************ Embeds UI ************/
function addEmbed(pre={}){
  const data={ title:pre.title||'', description:pre.description||'', color:pre.color||'#5865f2' };
  embeds.push(data);
  const idx=embeds.length-1;
  const wrap=document.createElement('div');
  wrap.className='embed-card';
  wrap.innerHTML=`
    <label>Title</label>
    <input type="text" value="${esc(data.title)}" data-i="${idx}" data-f="title">
    <label>Description</label>
    <textarea data-i="${idx}" data-f="description">${esc(data.description)}</textarea>
    <label>Color</label>
    <input type="color" value="${data.color}" data-i="${idx}" data-f="color">
    <button class="btn-alt" data-remove="${idx}">‚ùå Remove</button>
  `;
  embedsEl.appendChild(wrap);
  wrap.querySelectorAll('input,textarea').forEach(inp=> inp.addEventListener('input', ()=>{ embeds[inp.dataset.i][inp.dataset.f]=inp.value; renderPreview(); }));
  wrap.querySelector('[data-remove]').addEventListener('click', ()=>{ embeds.splice(idx,1); wrap.remove(); renderPreview(); });
  renderPreview();
}
addEmbedBtn.addEventListener('click', ()=> addEmbed());

/************ Payload ************/
function buildEmbeds(){
  // Only include embeds that have at least one of the allowed fields filled
  return embeds.map(e=>{
    const out={};
    if(e.title) out.title=e.title;
    if(e.description) out.description=e.description;
    if(e.color) out.color=parseInt(e.color.replace('#',''),16); // Discord expects integer color
    return out;
  }).filter(e=> Object.keys(e).length>0);
}
function buildPayload(){
  const p={};
  const c=(content.value||'').trim(); if(c) p.content=c; 
  if(username.value) p.username=username.value; if(avatarURL.value) p.avatar_url=avatarURL.value;
  const em=buildEmbeds(); if(em.length) p.embeds=em;
  return p;
}

/************ Send + Test ************/
async function sendPayload(test=false){
  const url=webhookURL.value.trim(); if(!url){ return showResp('Enter webhook URL', false); }
  const body = test? { content:'‚úÖ Test from Webhook Manager' } : buildPayload();
  if(!test && !body.content && !(body.embeds && body.embeds.length)){
    return showResp('Add message text or an embed before sending.', false);
  }
  try{
    const r = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
    const txt = await r.text();
    let parsed; try{ parsed = JSON.parse(txt); }catch{}
    if(r.ok){ showResp('Message sent ‚úÖ', true); return; }
    // Improved error surface
    if(parsed && parsed.message){
      const details = parsed.errors ? JSON.stringify(parsed.errors) : '';
      showResp(`Error: ${parsed.message}${details? ' ‚Äî '+details: ''}`, false);
    } else {
      showResp(`Error ${r.status}: ${txt || 'Request failed'}`, false);
    }
  }catch(e){
    showResp('Network error: '+e.message+ (location.protocol==='file:'? ' (tip: open in a regular browser)':''), false);
  }
}

fabSend.addEventListener('click', ()=> sendPayload(false));

/************ Utils ************/
function showResp(text, ok){ resp.style.display='block'; resp.textContent=text; resp.className='response '+(ok?'ok':'err'); setTimeout(()=>{ resp.style.display='none'; }, 5000); }

/************ Init ************/
if(location.protocol==='file:'){ banner.style.display='block'; }
renderPreview();
</script>
</body>
</html>
